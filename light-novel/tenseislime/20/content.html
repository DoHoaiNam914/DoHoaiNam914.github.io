<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1">
    <title>転生したらスライムだった件 20</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="../../js/app.js"></script>
    <script>
      $(document).ready(function () {
        let spineList = ['p-cover',
          'p-fmatter-001',
          'p-fmatter-002',
          'p-fmatter-003',
          'p-caution',
          'p-fmatter-004',
          'p-toc',
          'p-001',
          'p-002',
          'p-003',
          'p-004',
          'p-005',
          'p-006',
          'p-007',
          'p-008',
          'p-009',
          'p-010',
          'p-011',
          'p-012',
          'p-013',
          'p-014',
          'p-015',
          'p-016',
          'p-017',
          'p-colophon',
          'p-018',
          'p-019',
          'p-bmatter-001',
          'p-bmatter-002',
          'p-bmatter-003',
          'p-bmatter-004',
          'p-bmatter-005'];

        for (let i = 0; i < spineList.length; i++) {
          let spineName = spineList[i];
          xhr.onreadystatechange = function () {
            if (this.readyState === this.DONE) {
              let html = parser.parseFromString(xhr.responseText.replace(/<ruby>/g, '').replace(/<\/ruby>/g, '').replace(new RegExp('([⺀-⿕]*)</span><rt>[ぁ-ゟ]*</rt>', 'g'), '$1</span>').replace(new RegExp('([⺀-⿕]*)</span><rt>([゠-ヿ]*)</rt>', 'g'), ' $1（$2）</span>'), 'application/xhtml+xml');

            if (i === 4) {
                $(document.documentElement).attr("class", $(html.documentElement).attr("class"));
                $(document.documentElement).attr("lang", "ja");
                $(document.head).html($(html.head).prop("innerHTML"));
                $("meta[charset=\"utf-8\"]").replaceWith(`<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="initial-scale=1, user-scalable=0, maximum-scale=1">`);
                let stylesheet = $("link[href=\"../style/book-style.css\"]").prop("outerHTML");
                $("link[href=\"../style/book-style.css\"]").remove();
                $("script[src=\"../../js/kobo.js\"]").remove();
                $("style[id=\"koboSpanStyle\"]").remove();
                $(document.head).append(`<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"><\/script>
<script src="../../js/js.cookie.js"><\/script>`);
                $(document.head).append("<link rel=\"stylesheet\" href=\"../../css/styles/DoHoaiNamStyle/fonts_patch.css\">\n<link rel=\"stylesheet\" href=\"../../css/styles/DoHoaiNamStyle-before.css\">\n" + stylesheet + "\n<link rel=\"stylesheet\" href=\"../../css/styles/DoHoaiNamStyle-after.css\">");
                $("#background_select").val(Cookies.get('background') || "white").change();
              }

              $(document.body).append("\n<div>" + html.body.innerHTML.toString().replace(new RegExp('../image', 'g'), 'https://raw.githubusercontent.com/DoHoaiNam914/CDN/main/light-novel/' + book.concat('/' + volume.concat('/item/image'))) + "</div>\n\n");
            }
          }

          xhr.open("GET", volume.concat('/xhtml/' + spineName.concat('.xhtml')), false);
          xhr.send();
        }
      });
    </script>
  </head>
</html>